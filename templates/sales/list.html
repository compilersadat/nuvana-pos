{% extends 'base.html' %}
{% block title %}Sales — Stationery POS{% endblock %}
{% block breadcrumb %}Sales{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>Sales</h3>
  <a class="btn btn-success" href="{% url 'pos_sale_create' %}">New Sale</a>
</div>

<form class="row g-2 mb-3">
  <div class="col-auto">
    <input type="date" name="start" value="{{ start }}" class="form-control" placeholder="Start">
  </div>
  <div class="col-auto">
    <input type="date" name="end" value="{{ end }}" class="form-control" placeholder="End">
  </div>
  <div class="col-auto">
    <input type="text" name="q" value="{{ q }}" class="form-control" placeholder="Customer or INV/CRN">
  </div>
  {% if page_size %}<input type="hidden" name="page_size" value="{{ page_size }}">{% endif %}
  <div class="col-auto">
    <button class="btn btn-outline-secondary">Filter</button>
  </div>
</form>

<div class="text-end mb-2"><b>Total: ₹ {{ total|floatformat:2 }}</b></div>

<div class="table-responsive">
  <table class="table table-striped table-hover table-sticky align-middle">
    <thead>
      <tr>
        <th style="width:80px">No.</th>
        <th style="width:120px">Date</th>
        <th>Customer</th>
        <th style="width:120px">Type</th>
        <th class="text-end" style="width:120px">Subtotal</th>
        <th class="text-end" style="width:100px">Tax</th>
        <th class="text-end" style="width:120px">Total</th>
        <th style="width:160px"></th>
      </tr>
    </thead>
    <tbody>
      {% for s in page_obj %}
      <tr>
        <td>{{ s.is_return|yesno:"CRN,INV" }}-{{ s.id }}</td>
        <td>{{ s.date }}</td>
        <td>{% if s.customer %}{{ s.customer.name }}{% else %}<span class="text-muted">Walk-in</span>{% endif %}</td>
        <td>{{ s.is_return|yesno:"Credit Note,Invoice" }}</td>
        <td class="text-end">₹ {{ s.subtotal|floatformat:2 }}</td>
        <td class="text-end">₹ {{ s.tax|floatformat:2 }}</td>
        <td class="text-end fw-semibold">₹ {{ s.total|floatformat:2 }}</td>
        <td class="text-end">
          <a class="btn btn-sm btn-outline-secondary" href="{% url 'invoice_view' s.id %}">View</a>
          <a class="btn btn-sm btn-primary" href="{% url 'sale_update' sale_id=s.id %}">Edit</a>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="8" class="text-center text-muted">No sales</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% include "partials/pagination.html" with page_obj=page_obj base_qs=base_qs page_size=page_size %}
{% endblock %}
